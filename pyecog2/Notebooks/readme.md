This really needs to be cleaned up